version: '3'
services:
  # 這是你的 Node.js 程式
  backend:
    build: .
    restart: always
    # 注意：這裡不需要 ports 對外暴露 3000，因為只有 Nginx 需要跟它連線

    # 讓後端容器的 /public 資料夾跟外面的 /public 資料夾同步
    # 這樣 C++ 產生的檔案才會出現在你電腦上，Nginx 才讀得到。
    volumes:
      - ./public:/usr/src/app/public
  # 這是 Nginx 伺服器
  nginx:
    image: nginx:latest
    ports:
      - "80:80" # 對外開放標準網頁 Port 80
    volumes:
      # 把你的設定檔掛進去
      - ./nginx.conf:/etc/nginx/nginx.conf
      # 把靜態檔案掛進去給 Nginx 讀 (對應 public 資料夾)
      - ./public:/usr/share/nginx/html
    depends_on:
      - backend